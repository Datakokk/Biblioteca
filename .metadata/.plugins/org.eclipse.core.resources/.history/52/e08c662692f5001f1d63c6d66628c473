System.out.println("üìö Bienvenido al Sistema de Biblioteca");

// 1Ô∏è‚É£ INICIO DE SESI√ìN
System.out.print("Ingrese su email: ");
String email = scanner.nextLine();
System.out.print("Ingrese su contrase√±a: ");
String password = scanner.nextLine();

// Buscar usuario en la base de datos
Usuario usuario = usuarioServicio.obtenerUsuarioPorEmail(email);

if (usuario == null || !usuario.getPassword().equals(password)) {
    System.out.println("‚ùå Credenciales incorrectas. Saliendo...");
    return;
}

String rolUsuario = usuario.getRol(); // Obtenemos el rol del usuario
System.out.println("‚úÖ Bienvenido, " + usuario.getNombre() + " | Rol: " + rolUsuario);

while (true) {
    // 2Ô∏è‚É£ MEN√ö SEG√öN EL ROL
    if (rolUsuario.equalsIgnoreCase("admin")) {
        System.out.println("\nüîπ Men√∫ Administrador:");
        System.out.println("1. Agregar usuario");
        System.out.println("2. Agregar libro");
        System.out.println("3. Registrar pr√©stamo");
        System.out.println("4. Registrar devoluci√≥n");
        System.out.println("5. Listar libros");
        System.out.println("6. Actualizar libro");
        System.out.println("7. Eliminar libro");
        System.out.println("8. Reporte de Pr√©stamos Activos");
        System.out.println("9. Reporte de Usuarios con M√°s Pr√©stamos");
        System.out.println("10. Reporte de Libros M√°s Prestados");
        System.out.println("11. Salir");
    } else { // Si es un usuario normal
        System.out.println("\nüîπ Men√∫ Usuario:");
        System.out.println("1. Listar libros disponibles");
        System.out.println("2. Registrar pr√©stamo");
        System.out.println("3. Registrar devoluci√≥n");
        System.out.println("4. Ver mis pr√©stamos activos");
        System.out.println("5. Salir");
    }

    System.out.print("Seleccione una opci√≥n: ");
    int opcion = scanner.nextInt();
    scanner.nextLine();

    if (rolUsuario.equalsIgnoreCase("admin")) {
        switch (opcion) {
            case 1:
                System.out.print("Ingrese nombre: ");
                String nombre = scanner.nextLine();
                System.out.print("Ingrese email: ");
                String nuevoEmail = scanner.nextLine();
                System.out.print("Ingrese tel√©fono: ");
                String telefono = scanner.nextLine();
                System.out.print("Ingrese rol (admin/usuario): ");
                String nuevoRol = scanner.nextLine();
                System.out.print("Ingrese contrase√±a: ");
                String nuevaPassword = scanner.nextLine();

                Usuario nuevoUsuario = new Usuario();
                nuevoUsuario.setNombre(nombre);
                nuevoUsuario.setEmail(nuevoEmail);
                nuevoUsuario.setTelefono(telefono);
                nuevoUsuario.setRol(nuevoRol);
                nuevoUsuario.setPassword(nuevaPassword);

                usuarioServicio.registrarUsuario(nuevoUsuario);
                System.out.println("‚úÖ Usuario registrado con √©xito!");
                break;
            
            case 11:
                System.out.println("üëã Saliendo del sistema...");
                return;
        }
    } else {
        switch (opcion) {
            case 1:
                List<Libro> libros = libroServicio.listarLibros();
                System.out.println("üìö Libros disponibles:");
                for (Libro l : libros) {
                    if (l.getEstado().equalsIgnoreCase("disponible")) {
                        System.out.println(l.getIdLibro() + " - " + l.getTitulo() + " de " + l.getAutor());
                    }
                }
                break;
            
            case 5:
                System.out.println("üëã Saliendo del sistema...");
                return;
        }
    }
}
